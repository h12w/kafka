<!DOCTYPE html>
<html>

<head>
    <title>A Guide To The Kafka Protocol - Apache Kafka - Apache Software Foundation</title>
</head>

<body>
    <h1>Kafka Protocol (Nov 27, 2015 23:58)</h1>
    <div class="toc-macro client-side-toc-macro  hidden-outline" data-headerelements="H1,H2,H3,H4,H5,H6,H7">
        <ul style="">
            <li><span class="toc-item-body" data-outline="1"><span class="toc-outline">1</span><a href="#AGuideToTheKafkaProtocol-Introduction" class="toc-link">Introduction</a>
                </span>
            </li>
            <li><span class="toc-item-body" data-outline="2"><span class="toc-outline">2</span><a href="#AGuideToTheKafkaProtocol-Overview" class="toc-link">Overview</a>
                </span>
            </li>
            <li><span class="toc-item-body" data-outline="3"><span class="toc-outline">3</span><a href="#AGuideToTheKafkaProtocol-Preliminaries" class="toc-link">Preliminaries</a>
                </span>
                <ul style="">
                    <li><span class="toc-item-body" data-outline="3.1"><span class="toc-outline">3.1</span><a href="#AGuideToTheKafkaProtocol-Network" class="toc-link">Network</a>
                        </span>
                    </li>
                    <li><span class="toc-item-body" data-outline="3.2"><span class="toc-outline">3.2</span><a href="#AGuideToTheKafkaProtocol-Partitioningandbootstrapping" class="toc-link">Partitioning and bootstrapping</a>
                        </span>
                    </li>
                    <li><span class="toc-item-body" data-outline="3.3"><span class="toc-outline">3.3</span><a href="#AGuideToTheKafkaProtocol-PartitioningStrategies" class="toc-link">Partitioning Strategies</a>
                        </span>
                    </li>
                    <li><span class="toc-item-body" data-outline="3.4"><span class="toc-outline">3.4</span><a href="#AGuideToTheKafkaProtocol-Batching" class="toc-link">Batching</a>
                        </span>
                    </li>
                    <li><span class="toc-item-body" data-outline="3.5"><span class="toc-outline">3.5</span><a href="#AGuideToTheKafkaProtocol-VersioningandCompatibility" class="toc-link">Versioning and Compatibility</a>
                        </span>
                    </li>
                </ul>
            </li>
            <li><span class="toc-item-body" data-outline="4"><span class="toc-outline">4</span><a href="#AGuideToTheKafkaProtocol-TheProtocol" class="toc-link">The Protocol</a>
                </span>
                <ul style="">
                    <li><span class="toc-item-body" data-outline="4.1"><span class="toc-outline">4.1</span><a href="#AGuideToTheKafkaProtocol-ProtocolPrimitiveTypes" class="toc-link">Protocol Primitive Types</a>
                        </span>
                    </li>
                    <li><span class="toc-item-body" data-outline="4.2"><span class="toc-outline">4.2</span><a href="#AGuideToTheKafkaProtocol-Notesonreadingtherequestformatgrammars" class="toc-link">Notes on reading the request format grammars</a>
                        </span>
                    </li>
                    <li><span class="toc-item-body" data-outline="4.3"><span class="toc-outline">4.3</span><a href="#AGuideToTheKafkaProtocol-CommonRequestandResponseStructure" class="toc-link">Common Request and Response Structure</a>
                        </span>
                        <ul style="">
                            <li><span class="toc-item-body" data-outline="4.3.1"><span class="toc-outline">4.3.1</span><a href="#AGuideToTheKafkaProtocol-Requests" class="toc-link">Requests</a>
                                </span>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.3.2"><span class="toc-outline">4.3.2</span><a href="#AGuideToTheKafkaProtocol-Responses" class="toc-link">Responses</a>
                                </span>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.3.3"><span class="toc-outline">4.3.3</span><a href="#AGuideToTheKafkaProtocol-Messagesets" class="toc-link">Message sets</a>
                                </span>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.3.4"><span class="toc-outline">4.3.4</span><a href="#AGuideToTheKafkaProtocol-Compression" class="toc-link">Compression</a>
                                </span>
                            </li>
                        </ul>
                    </li>
                    <li><span class="toc-item-body" data-outline="4.4"><span class="toc-outline">4.4</span><a href="#AGuideToTheKafkaProtocol-TheAPIs" class="toc-link">The APIs</a>
                        </span>
                        <ul style="">
                            <li><span class="toc-item-body" data-outline="4.4.1"><span class="toc-outline">4.4.1</span><a href="#AGuideToTheKafkaProtocol-MetadataAPI" class="toc-link">Metadata API</a>
                                </span>
                                <ul style="">
                                    <li><span class="toc-item-body" data-outline="4.4.1.1"><span class="toc-outline">4.4.1.1</span><a href="#AGuideToTheKafkaProtocol-TopicMetadataRequest" class="toc-link">Topic Metadata Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.1.2"><span class="toc-outline">4.4.1.2</span><a href="#AGuideToTheKafkaProtocol-MetadataResponse" class="toc-link">Metadata Response</a>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.4.2"><span class="toc-outline">4.4.2</span><a href="#AGuideToTheKafkaProtocol-ProduceAPI" class="toc-link">Produce API</a>
                                </span>
                                <ul style="">
                                    <li><span class="toc-item-body" data-outline="4.4.2.1"><span class="toc-outline">4.4.2.1</span><a href="#AGuideToTheKafkaProtocol-ProduceRequest" class="toc-link">Produce Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.2.2"><span class="toc-outline">4.4.2.2</span><a href="#AGuideToTheKafkaProtocol-ProduceResponse" class="toc-link">Produce Response</a>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.4.3"><span class="toc-outline">4.4.3</span><a href="#AGuideToTheKafkaProtocol-FetchAPI" class="toc-link">Fetch API</a>
                                </span>
                                <ul style="">
                                    <li><span class="toc-item-body" data-outline="4.4.3.1"><span class="toc-outline">4.4.3.1</span><a href="#AGuideToTheKafkaProtocol-FetchRequest" class="toc-link">Fetch Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.3.2"><span class="toc-outline">4.4.3.2</span><a href="#AGuideToTheKafkaProtocol-FetchResponse" class="toc-link">Fetch Response</a>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.4.4"><span class="toc-outline">4.4.4</span><a href="#AGuideToTheKafkaProtocol-OffsetAPI" class="toc-link">Offset API</a>
                                </span>
                                <ul style="">
                                    <li><span class="toc-item-body" data-outline="4.4.4.1"><span class="toc-outline">4.4.4.1</span><a href="#AGuideToTheKafkaProtocol-OffsetRequest" class="toc-link">Offset Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.4.2"><span class="toc-outline">4.4.4.2</span><a href="#AGuideToTheKafkaProtocol-OffsetResponse" class="toc-link">Offset Response</a>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.4.5"><span class="toc-outline">4.4.5</span><a href="#AGuideToTheKafkaProtocol-OffsetCommit/FetchAPI" class="toc-link">Offset Commit/Fetch API</a>
                                </span>
                                <ul style="">
                                    <li><span class="toc-item-body" data-outline="4.4.5.1"><span class="toc-outline">4.4.5.1</span><a href="#AGuideToTheKafkaProtocol-GroupCoordinatorRequest" class="toc-link">Group Coordinator Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.5.2"><span class="toc-outline">4.4.5.2</span><a href="#AGuideToTheKafkaProtocol-GroupCoordinatorResponse" class="toc-link">Group Coordinator Response</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.5.3"><span class="toc-outline">4.4.5.3</span><a href="#AGuideToTheKafkaProtocol-OffsetCommitRequest" class="toc-link">Offset Commit Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.5.4"><span class="toc-outline">4.4.5.4</span><a href="#AGuideToTheKafkaProtocol-OffsetCommitResponse" class="toc-link">Offset Commit Response</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.5.5"><span class="toc-outline">4.4.5.5</span><a href="#AGuideToTheKafkaProtocol-OffsetFetchRequest" class="toc-link">Offset Fetch Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.5.6"><span class="toc-outline">4.4.5.6</span><a href="#AGuideToTheKafkaProtocol-OffsetFetchResponse" class="toc-link">Offset Fetch Response</a>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.4.6"><span class="toc-outline">4.4.6</span><a href="#AGuideToTheKafkaProtocol-GroupMembershipAPI" class="toc-link">Group Membership API</a>
                                </span>
                                <ul style="">
                                    <li><span class="toc-item-body" data-outline="4.4.6.1"><span class="toc-outline">4.4.6.1</span><a href="#AGuideToTheKafkaProtocol-JoinGroupRequest" class="toc-link">Join Group Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.6.2"><span class="toc-outline">4.4.6.2</span><a href="#AGuideToTheKafkaProtocol-JoinGroupResponse" class="toc-link">Join Group Response</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.6.3"><span class="toc-outline">4.4.6.3</span><a href="#AGuideToTheKafkaProtocol-SyncGroupRequest" class="toc-link">SyncGroup Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.6.4"><span class="toc-outline">4.4.6.4</span><a href="#AGuideToTheKafkaProtocol-SyncGroupResponse" class="toc-link">Sync Group Response</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.6.5"><span class="toc-outline">4.4.6.5</span><a href="#AGuideToTheKafkaProtocol-HeartbeatRequest" class="toc-link">Heartbeat Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.6.6"><span class="toc-outline">4.4.6.6</span><a href="#AGuideToTheKafkaProtocol-HeartbeatResponse" class="toc-link">Heartbeat Response</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.6.7"><span class="toc-outline">4.4.6.7</span><a href="#AGuideToTheKafkaProtocol-LeaveGroupRequest" class="toc-link">LeaveGroup Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.6.8"><span class="toc-outline">4.4.6.8</span><a href="#AGuideToTheKafkaProtocol-LeaveGroupResponse" class="toc-link">LeaveGroup Response</a>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.4.7"><span class="toc-outline">4.4.7</span><a href="#AGuideToTheKafkaProtocol-AdministrativeAPI" class="toc-link">Administrative API</a>
                                </span>
                                <ul style="">
                                    <li><span class="toc-item-body" data-outline="4.4.7.1"><span class="toc-outline">4.4.7.1</span><a href="#AGuideToTheKafkaProtocol-ListGroupsRequest" class="toc-link">ListGroups Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.7.2"><span class="toc-outline">4.4.7.2</span><a href="#AGuideToTheKafkaProtocol-ListGroupsResponse" class="toc-link">ListGroups Response</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.7.3"><span class="toc-outline">4.4.7.3</span><a href="#AGuideToTheKafkaProtocol-DescribeGroupsRequest" class="toc-link">DescribeGroups Request</a>
                                        </span>
                                    </li>
                                    <li><span class="toc-item-body" data-outline="4.4.7.4"><span class="toc-outline">4.4.7.4</span><a href="#AGuideToTheKafkaProtocol-DescribeGroupsResponse" class="toc-link">DescribeGroups Response</a>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><span class="toc-item-body" data-outline="4.5"><span class="toc-outline">4.5</span><a href="#AGuideToTheKafkaProtocol-Constants" class="toc-link">Constants</a>
                        </span>
                        <ul style="">
                            <li><span class="toc-item-body" data-outline="4.5.1"><span class="toc-outline">4.5.1</span><a href="#AGuideToTheKafkaProtocol-ApiKeys" class="toc-link">Api Keys</a>
                                </span>
                            </li>
                            <li><span class="toc-item-body" data-outline="4.5.2"><span class="toc-outline">4.5.2</span><a href="#AGuideToTheKafkaProtocol-ErrorCodes" class="toc-link">Error Codes</a>
                                </span>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li><span class="toc-item-body" data-outline="5"><span class="toc-outline">5</span><a href="#AGuideToTheKafkaProtocol-SomeCommonPhilosophicalQuestions" class="toc-link">Some Common Philosophical Questions</a>
                </span>
            </li>
        </ul>
    </div>
    <p></p>
    <h3 id="AGuideToTheKafkaProtocol-Introduction">Introduction</h3>
    <p>This document covers the protocol implemented in Kafka 0.8 and beyond. It is meant to give a readable guide to the protocol that covers the available requests, their binary format, and the proper way to make use of them to implement a client. This document assumes you understand the basic design and terminology described <a href="https://kafka.apache.org/documentation.html#design" class="external-link" rel="nofollow">here</a>.</p>
    <p>The <a href="/confluence/display/KAFKA/Wire+Format">protocol used in 0.7</a> and earlier is similar to this, but we chose to make a one time (we hope) break in&nbsp;compatibility&nbsp;to be able to clean up cruft and generalize things.</p>
    <h3 id="AGuideToTheKafkaProtocol-Overview">Overview</h3>
    <p>The Kafka protocol is fairly simple, there are only six core client requests APIs.</p>
    <ol>
        <li>Metadata - Describes the currently available brokers, their host and port information, and gives information about which broker hosts which partitions.</li>
        <li>Send - Send messages to a broker</li>
        <li>Fetch - Fetch messages from a broker, one which fetches data, one which gets cluster metadata, and one which gets offset information about a topic.</li>
        <li>Offsets - Get information about the available offsets for a given topic partition.</li>
        <li>Offset Commit - Commit a set of offsets for a consumer group</li>
        <li>Offset Fetch - Fetch a set of offsets for a consumer group</li>
    </ol>
    <p>Each of these will be described in detail below. Additionally, as&nbsp;of 0.9, Kafka supports general group management for consumers and Kafka Connect. The client API consists of five requests:</p>
    <ol>
        <li>GroupCoordinator - Locate the current coordinator of a group.</li>
        <li>JoinGroup - Become a member of a group, creating it if there are no active members.</li>
        <li>SyncGroup - Synchronize state for all members of a group (e.g. distribute partition assignments to consumers).</li>
        <li>Heartbeat - Keep a member alive in the group.&nbsp;</li>
        <li>LeaveGroup - Directly depart a group.</li>
    </ol>
    <p>Finally, there are several administrative APIs which can be used to monitor/administer the Kafka cluster (this list will grow when <a href="/confluence/display/KAFKA/KIP-4+-+Command+line+and+centralized+administrative+operations">KIP-4</a> is completed).</p>
    <ol>
        <li>DescribeGroups - Used to inspect the current state of a set of groups (e.g. to view consumer partition assignments). &nbsp;</li>
        <li>ListGroups - List the current groups managed by a broker.</li>
    </ol>
    <h3 id="AGuideToTheKafkaProtocol-Preliminaries">Preliminaries</h3>
    <h4 id="AGuideToTheKafkaProtocol-Network">Network</h4>
    <p>Kafka uses a binary protocol over TCP. The protocol defines all apis as request response message pairs. All messages are size delimited and are made up of the following primitive types.</p>
    <p>The client initiates a socket connection and then writes a sequence of request messages and reads back the corresponding response message. No handshake is required on connection or disconnection. TCP is happier if you maintain persistent connections used for many requests to amortize the cost of the TCP handshake, but beyond this penalty connecting is pretty cheap.</p>
    <p>The client will likely need to maintain a connection to multiple brokers, as data is partitioned and the clients will need to talk to the server that has their data. However it should not generally be necessary to maintain multiple connections to a single broker from a single client instance (i.e. connection pooling).</p>
    <p>The server guarantees that on a single TCP connection, requests will be processed in the order they are sent and responses will return in that order as well. The broker's request processing allows only a single in-flight request per connection in order to guarantee this ordering. Note that clients can (and ideally should) use non-blocking IO to implement request pipelining and achieve higher throughput. i.e., clients can send requests even while awaiting responses for preceding requests since the outstanding requests will be buffered in the underlying OS socket buffer. All requests are initiated by the client, and result in a corresponding response message from the server except where noted.</p>
    <p>The server has a configurable maximum limit on request size and any request that exceeds this limit will result in the socket being disconnected.</p>
    <h4 id="AGuideToTheKafkaProtocol-Partitioningandbootstrapping">Partitioning and bootstrapping</h4>
    <p>Kafka is a partitioned system so not all servers have the complete data set. Instead recall that topics are split into a pre-defined number of partitions, P, and each partition is replicated with some replication factor, N. Topic partitions themselves are just ordered "commit logs" numbered 0, 1, ..., P.</p>
    <p>All systems of this nature have the question of how a particular piece of data is assigned to a particular partition. Kafka clients directly control this assignment, the brokers themselves enforce no particular semantics of which messages <em>should</em> be published to a particular partition. Rather, to publish messages the client directly addresses messages to a particular partition, and when fetching messages, fetches from a particular partition.&nbsp;If two clients want to use the same partitioning scheme they must use the same method to compute the mapping of key to partition.</p>
    <p>These requests to publish or fetch data must be sent to the broker that is currently acting as the leader for a given partition. This condition is enforced by the broker, so a request for a particular partition to the wrong broker will result in an the&nbsp;NotLeaderForPartition error code (described below).&nbsp;</p>
    <p>How can the client find out which topics exist, what partitions they have, and which brokers currently host those partitions so that it can direct its requests to the right hosts? This information is dynamic, so you can't just configure each client with some static mapping file. Instead all Kafka brokers can answer a metadata request that describes the current state of the cluster: what topics there are, which partitions those topics have, which broker is the leader for those partitions, and the host and port information for these brokers.</p>
    <p>In other words, the client needs to somehow find one broker and that broker will tell the client about all the other brokers that exist and what partitions they host. This first broker may itself go down so the best practice for a client implementation is to take a list of two or three urls to bootstrap from. The user can then choose to use a load balancer or just statically configure two or three of their kafka hosts in the clients.</p>
    <p>The client does not need to keep polling to see if the cluster has changed; it can fetch metadata once when it is instantiated cache that metadata until it receives an error indicating that the metadata is out of date. This error can come in two forms: (1) a socket error indicating the client cannot communicate with a particular broker, (2) an error code in the response to a request indicating that this broker no longer hosts the partition for which data was requested.</p>
    <ol>
        <li>Cycle through a list of "bootstrap" kafka urls until we find one we can connect to. Fetch cluster metadata.</li>
        <li>Process fetch or produce requests, directing them to the appropriate broker based on the topic/partitions they send to or fetch from.</li>
        <li>If we get an appropriate error, refresh the metadata and try again.</li>
    </ol>
    <h4 id="AGuideToTheKafkaProtocol-PartitioningStrategies">Partitioning Strategies</h4>
    <p>As mentioned above the assignment of messages to partitions is something the producing client controls. That said, how should this functionality be exposed to the end-user?</p>
    <p>Partitioning really serves two purposes in Kafka:</p>
    <ol>
        <li>It balances data and request load over brokers</li>
        <li>It serves as a way to divvy up processing among consumer processes while allowing local state and preserving order within the partition. We call this semantic partitioning.</li>
    </ol>
    <p>For a given use case you may care about only one of these or both.</p>
    <p>To accomplish simple load balancing a simple approach would be for the client to just round robin requests over all brokers. Another alternative, in an environment where there are many more producers than brokers, would be to have each client chose a single partition at random and publish to that. This later strategy will result in far fewer TCP connections.</p>
    <p>Semantic partitioning means using some key in the message to assign messages to partitions. For example if you were processing a click message stream you might want to partition the stream by the user id so that all data for a particular user would go to a single consumer. To accomplish this the client can take a key associated with the message and use some hash of this key to choose the partition to which to deliver the message.</p>
    <h4 id="AGuideToTheKafkaProtocol-Batching">Batching</h4>
    <p>Our apis encourage batching small things together for efficiency. We have found this is a very significant performance win. Both our API to send messages and our API to fetch messages always work with a sequence of messages not a single message to encourage this. A clever client can make use of this and support an "asynchronous" mode in which it batches together messages sent individually and sends them in larger clumps. We go even further with this and allow the batching across multiple topics and partitions, so a produce request may contain data to append to many partitions and a fetch request may pull data from many partitions all at once.</p>
    <p>The client implementer can choose to ignore this and send everything one at a time if they like.</p>
    <h4 id="AGuideToTheKafkaProtocol-VersioningandCompatibility">Versioning and Compatibility</h4>
    <p>The protocol is designed to enable incremental evolution in a backward compatible fashion. Our versioning is on a per-api basis, each version consisting of a request and response pair. Each request contains an API key that identifies the API being invoked and a version number that indicates the format of the request and the expected format of the response.</p>
    <p>The intention is that clients would implement a particular version of the protocol, and indicate this version in their requests. Our goal is primarily to allow API evolution in an environment where downtime is not allowed and clients and servers cannot all be changed at once.</p>
    <p>The server will reject requests with a version it does not support, and will always respond to the client with exactly the protocol format it expects based on the version it included in its request. The intended upgrade path is that new features would first be rolled out on the server (with the older clients not making use of them) and then as newer clients are deployed these new features would gradually be taken advantage of.</p>
    <p>Currently all versions are baselined at 0, as we evolve these APIs we will indicate the format for each version individually.</p>
    <h3 id="AGuideToTheKafkaProtocol-TheProtocol">The Protocol</h3>
    <h4 id="AGuideToTheKafkaProtocol-ProtocolPrimitiveTypes">Protocol Primitive Types</h4>
    <p>The protocol is built out of the following primitive types.</p>
    <p><span style="text-decoration: underline;">Fixed Width Primitives</span>
    </p>
    <p><em>int8, int16, int32, int64</em>&nbsp;- Signed integers with the given precision (in bits) stored in big endian order.</p>
    <p><span style="text-decoration: underline;">Variable Length Primitives</span>
    </p>
    <p>bytes, string - These types consist of a signed integer giving a length N followed by N bytes of content. A length of -1 indicates null. string uses an int16 for its size, and bytes uses an int32.</p>
    <p><span style="text-decoration: underline;">Arrays</span>
    </p>
    <p>This is a notation for handling repeated structures. These will always be encoded as an int32 size containing the length N followed by N repetitions of the structure which can itself be made up of other primitive types. In the BNF grammars below we will show an array of a structure foo as [foo].</p>
    <h4 id="AGuideToTheKafkaProtocol-Notesonreadingtherequestformatgrammars">Notes on reading the request format grammars</h4>
    <p>The&nbsp;<a href="http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form" class="external-link" rel="nofollow">BNF</a>s below give an exact context free grammar for the request and response binary format. For each API I will give the request and response together followed by all the sub-definitions. The BNF is intentionally not compact in order to give human-readable name (for example I define a production for ErrorCode even though it is just an int16 in order to give it a symbolic name). As always in a BNF a sequence of productions indicates concatenation, so the MetadataRequest given below would be a sequence of bytes containing first a VersionId, then a ClientId, and then an array of TopicNames (each of which has its own definition). Productions are always given in camel case and primitive types in lower case. When there are multiple possible productions these are&nbsp;separated&nbsp;with '|' and may be enclosed in parenthesis for grouping. The top-level definition is always given first and subsequent sub-parts are indented.</p>
    <h4 id="AGuideToTheKafkaProtocol-CommonRequestandResponseStructure">Common Request and Response Structure</h4>
    <p>All requests and responses originate from the following grammar which will be incrementally describe through the rest of this document:</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_761127" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">RequestOrResponse =&gt; Size (RequestMessage | ResponseMessage)</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Size =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>MessageSize</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The MessageSize field gives the size of the subsequent request or response message in bytes. The client can read requests by first reading this 4 byte size as an integer N, and then reading and parsing the subsequent N bytes of the request.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-Requests">Requests</h6>
    <p>Requests all have the following format:</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_449350" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">RequestMessage =&gt; ApiKey ApiVersion CorrelationId ClientId RequestMessage</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ApiKey =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ApiVersion =&gt; int16</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">CorrelationId =&gt; int32</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ClientId =&gt; string</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">RequestMessage =&gt; MetadataRequest | ProduceRequest | FetchRequest | OffsetRequest | OffsetCommitRequest | OffsetFetchRequest</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>ApiKey</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is a numeric id for the API being invoked (i.e. is it a metadata request, a produce request, a fetch request, etc).</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>ApiVersion</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is a numeric version number for this api. We version each API and this version number allows the server to properly interpret the request as the protocol evolves. Responses will always be in the format corresponding to the request version. Currently the supported version for all APIs is 0.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>CorrelationId</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is a user-supplied integer. It will be passed back in the response by the server, unmodified. It is useful for matching request and response between the client and server.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>ClientId</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is a user supplied identifier for the client application. The user can use any identifier they like and it will be used when logging errors, monitoring aggregates, etc. For example, one might want to monitor not just the requests per second overall, but the number coming from each client application (each of which could reside on multiple servers). This id acts as a logical grouping across all requests from a particular client.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>The various request and response messages will be described below.</p>
    <h6 id="AGuideToTheKafkaProtocol-Responses">Responses</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_517761" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">Response =&gt; CorrelationId ResponseMessage</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java plain">CorrelationId =&gt; int32</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java plain">ResponseMessage =&gt; MetadataResponse | ProduceResponse | FetchResponse | OffsetResponse | OffsetCommitResponse | OffsetFetchResponse</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 713px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>CorrelationId</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The server passes back whatever integer the client supplied as the correlation in the request.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <p>The response will always match the paired request (e.g. we will send a MetadataResponse in return to a MetadataRequest).</p>
    <h6 id="AGuideToTheKafkaProtocol-Messagesets">Message sets</h6>
    <p>One structure common to both the produce and fetch requests is the message set format. A message in kafka is a key-value pair with a small amount of associated metadata. A message set is just a sequence of messages with offset and size information. This format happens to be used both for the on-disk storage on the broker and the on-the-wire format.</p>
    <p>A message set is also the unit of compression in Kafka, and we allow messages to recursively contain compressed message sets to allow batch compression.</p>
    <p>N.B., MessageSets are not preceded by an int32 like other array elements in the protocol.</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_222399" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">MessageSet =&gt; [Offset MessageSize Message]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Offset =&gt; int64</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MessageSize =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p>Message format</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_960866" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">Message =&gt; Crc MagicByte Attributes Key Value</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Crc =&gt; int32</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MagicByte =&gt; int8</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Attributes =&gt; int8</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Key =&gt; bytes</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Value =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>Offset</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is the offset used in kafka as the log sequence number. When the producer is sending messages it doesn't actually know the offset and can fill in any value here it likes.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Crc</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The CRC is the CRC32 of the remainder of the message bytes. This is used to check the integrity of the message on the broker and consumer.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MagicByte</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is a version id used to allow backwards compatible evolution of the message binary format. The current value is 0.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Attributes</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This byte holds metadata attributes about the message. The lowest 2 bits contain the compression codec used for the message. The other bits should be set to 0.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Key</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The key is an optional message key that was used for partition assignment. The key can be null.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Value</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The value is the actual message contents as an opaque byte array. Kafka supports recursive messages in which case this may itself contain a message set. The message can be null.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-Compression">Compression</h6>
    <p>Kafka supports compressing messages for additional efficiency, however this is more complex than just compressing a raw message. Because individual messages may not have sufficient redundancy to enable good compression ratios, compressed messages must be sent in special batches (although you may use a batch of one if you truly wish to compress a message on its own). The messages to be sent are wrapped (uncompressed) in a MessageSet structure, which is then compressed and stored in the Value field of a single "Message" with the appropriate compression codec set. The receiving system parses the actual MessageSet from the decompressed value. The outer MessageSet should contain only one compressed "Message" (see <a href="https://issues.apache.org/jira/browse/KAFKA-1718" class="external-link" rel="nofollow">KAFKA-1718</a> for details).</p>
    <p>Kafka currently supports two compression codecs with the following codec numbers:</p>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 187px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Compression</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Codec</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Compression</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Codec</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>None</p>
                    </td>
                    <td class="confluenceTd">
                        <p>0</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>GZIP</p>
                    </td>
                    <td class="confluenceTd">
                        <p>1</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Snappy</p>
                    </td>
                    <td class="confluenceTd">
                        <p>2</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h4 id="AGuideToTheKafkaProtocol-TheAPIs">The APIs</h4>
    <p>This section gives details on each of the individual APIs, their usage, their binary format, and the meaning of their fields.</p>
    <h5 id="AGuideToTheKafkaProtocol-MetadataAPI">Metadata API</h5>
    <p>This API answers the following questions:</p>
    <ul>
        <li>What topics exist?</li>
        <li>How many partitions does each topic have?</li>
        <li>Which broker is currently the leader for each partition?</li>
        <li>What is the host and port for each of these brokers?</li>
    </ul>
    <p>This is the only request that can be addressed to any broker in the cluster.</p>
    <p>Since there may be many topics the client can give an optional list of topic names in order to only return metadata for a subset of topics.</p>
    <p>The metadata returned is at the partition level, but grouped together by topic for convenience and to avoid redundancy. For each partition the metadata contains the information for the leader as well as for all the replicas and the list of replicas that are currently in-sync.</p>
    <p><strong>Note</strong>: If "<span>auto.create.topics.enable" is set in the broker configuration, a topic metadata request will create the topic with the default replication factor and number of partitions.&nbsp;</span>
    </p>
    <h6 id="AGuideToTheKafkaProtocol-TopicMetadataRequest">Topic Metadata Request</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_891450" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">TopicMetadataRequest =&gt; [TopicName]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>TopicName</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The topics to produce metadata for. If empty the request will yield metadata for all topics.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-MetadataResponse">Metadata Response</h6>
    <p>The response contains metadata for each partition, with partitions grouped together by topic. This metadata refers to brokers by their broker id. The brokers each have a host and port.</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_148886" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">MetadataResponse =&gt; [Broker][TopicMetadata]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Broker =&gt; NodeId Host Port&nbsp; (any number of brokers may be returned)</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">NodeId =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Host =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Port =&gt; int32</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicMetadata =&gt; TopicErrorCode TopicName [PartitionMetadata]</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TopicErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">PartitionMetadata =&gt; PartitionErrorCode PartitionId Leader Replicas Isr</code>
                                        </div>
                                        <div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">PartitionErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">PartitionId =&gt; int32</code>
                                        </div>
                                        <div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Leader =&gt; int32</code>
                                        </div>
                                        <div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Replicas =&gt; [int32]</code>
                                        </div>
                                        <div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Isr =&gt; [int32]</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1106px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>Leader</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The node id for the kafka broker currently acting as leader for this partition. If no leader exists because we are in the middle of a leader election this id will be -1.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Replicas</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The set of alive nodes that currently acts as slaves for the leader for this partition.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Isr</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The set subset of the replicas that are "caught up" to the leader</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Broker</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The node id, hostname, and port information for a kafka broker</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h5 id="AGuideToTheKafkaProtocol-ProduceAPI">Produce API</h5>
    <p>The produce API is used to send message sets to the server. For efficiency it allows sending message sets intended for many topic partitions in a single request.</p>
    <p>The produce API uses the generic message set format, but since no offset has been assigned to the messages at the time of the send the producer is free to fill in that field in any way it likes.</p>
    <h6 id="AGuideToTheKafkaProtocol-ProduceRequest">Produce Request</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_370823" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">ProduceRequest =&gt; RequiredAcks Timeout [TopicName [Partition MessageSetSize MessageSet]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">RequiredAcks =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Timeout =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MessageSetSize =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>RequiredAcks</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This field indicates how many acknowledgements the servers should receive before responding to the request. If it is 0 the server will not send any response (this is the only case where the server will not reply to a request). If it is 1, the server will wait the data is written to the local log before sending a response. If it is -1 the server will block until the message is committed by all in sync replicas before sending a response. For any number &gt; 1 the server will block waiting for this number of acknowledgements to occur (but the server will never wait for more acknowledgements than there are in-sync replicas).</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Timeout</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This provides a maximum time in milliseconds the server can await the receipt of the number of acknowledgements in RequiredAcks. The timeout is not an exact limit on the request time for a few reasons: (1) it does not include network latency, (2) the timer begins at the beginning of the processing of this request so if many requests are queued due to server overload that wait time will not be included, (3) we will not terminate a local write so if the local write time exceeds this timeout it will not be respected. To get a hard timeout of this type the client should use the socket timeout.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>TopicName</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The topic that data is being published to.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Partition</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The partition that data is being published to.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MessageSetSize</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The size, in bytes, of the message set that follows.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MessageSet</p>
                    </td>
                    <td class="confluenceTd">
                        <p>A set of messages in the standard format described above.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-ProduceResponse">Produce Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_915727" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">ProduceResponse =&gt; [TopicName [Partition ErrorCode Offset]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Offset =&gt; int64</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>Topic</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The topic this response entry corresponds to.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Partition</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The partition this response entry corresponds to.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>ErrorCode</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The error from this partition, if any. Errors are given on a per-partition basis because a given partition may be unavailable or maintained on a different host, while others may have successfully accepted the produce request.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Offset</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The offset assigned to the first message in the message set appended to this partition.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h5 id="AGuideToTheKafkaProtocol-FetchAPI">Fetch API</h5>
    <p>The fetch API is used to fetch a chunk of one or more logs for some topic-partitions. Logically one specifies the topics, partitions, and starting offset at which to begin the fetch and gets back a chunk of messages. In general, the return messages will have offsets larger than or equal to the starting offset. However, with compressed messages, it's possible for the returned messages to have offsets smaller than the starting offset. The number of such messages is typically small and the caller is responsible for filtering out those messages.</p>
    <p>Fetch requests follow a long poll model so they can be made to block for a period of time if sufficient data is not immediately available.</p>
    <p>As an optimization the server is allowed to return a partial message at the end of the message set. Clients should handle this case.</p>
    <p>One thing to note is that the fetch API requires specifying the partition to consume from. The question is how should a consumer know what partitions to consume from? In particular how can you balance the partitions over a set of consumers acting as a group so that each consumer gets a subset of partitions. We have done this assignment dynamically using zookeeper for the scala and java client. The downside of this approach is that it requires a fairly fat client and a zookeeper connection. We haven't yet created a Kafka API to allow this functionality to be moved to the server side and accessed more conveniently. A simple consumer client can be implemented by simply requiring that the partitions be specified in config, though this will not allow dynamic reassignment of partitions should that consumer fail. We hope to address this gap in the next major release.</p>
    <h6 id="AGuideToTheKafkaProtocol-FetchRequest">Fetch Request</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_701061" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">FetchRequest =&gt; ReplicaId MaxWaitTime MinBytes [TopicName [Partition FetchOffset MaxBytes]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ReplicaId =&gt; int32</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MaxWaitTime =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MinBytes =&gt; int32</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">FetchOffset =&gt; int64</code>
                                        </div>
                                        <div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MaxBytes =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>ReplicaId</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The replica id indicates the node id of the replica initiating this request. Normal client consumers should always specify this as -1 as they have no node id. Other brokers set this to be their own node id. The value -2 is accepted to allow a non-broker to issue fetch requests as if it were a replica broker for debugging purposes.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MaxWaitTime</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The max wait time is the maximum amount of time in milliseconds to block waiting if&nbsp;insufficient&nbsp;data is available at the time the request is issued.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MinBytes</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is the minimum number of bytes of messages that must be available to give a response. If the client sets this to 0 the server will always respond immediately, however if there is no new data since their last request they will just get back empty message sets. If this is set to 1, the server will respond as soon as at least one partition has at least 1 byte of data or the specified timeout occurs. By setting higher values in combination with the timeout the consumer can tune for throughput and trade a little additional latency for reading only large chunks of data (e.g. setting MaxWaitTime to 100 ms and setting MinBytes to 64k would allow the server to wait up to 100ms to try to accumulate 64k of data before responding).</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>TopicName</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The name of the topic.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Partition</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The id of the partition the fetch is for.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>FetchOffset</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The offset to begin this fetch from.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MaxBytes</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The maximum bytes to include in the message set for this partition. This helps bound the size of the response.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-FetchResponse">Fetch Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_112651" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">FetchResponse =&gt; [TopicName [Partition ErrorCode HighwaterMarkOffset MessageSetSize MessageSet]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">HighwaterMarkOffset =&gt; int64</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MessageSetSize =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>TopicName</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The name of the topic this response entry is for.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Partition</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The id of the partition this response is for.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>HighwaterMarkOffset</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The offset at the end of the log for this partition. This can be used by the client to determine how many messages behind the end of the log they are.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MessageSetSize</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The size in bytes of the message set for this partition</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MessageSet</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The message data fetched from this partition, in the format described above.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h5 id="AGuideToTheKafkaProtocol-OffsetAPI">Offset API</h5>
    <p>This API describes the valid offset range available for a set of topic-partitions. As with the produce and fetch APIs requests must be directed to the broker that is currently the leader for the partitions in question. This can be determined using the metadata API.</p>
    <p>The response contains the starting offset of each segment for the requested partition as well as the "log end offset" i.e. the offset of the next message that would be appended to the given partition.</p>
    <p>We agree that this API is slightly funky.</p>
    <h6 id="AGuideToTheKafkaProtocol-OffsetRequest">Offset Request</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_108311" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">OffsetRequest =&gt; ReplicaId [TopicName [Partition Time MaxNumberOfOffsets]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ReplicaId =&gt; int32</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Time =&gt; int64</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MaxNumberOfOffsets =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Decription</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Field</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Decription</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>Time</p>
                    </td>
                    <td class="confluenceTd">
                        <p>Used to ask for all messages before a certain time (ms). There are two special values. Specify -1 to receive the latest offset (i.e. the offset of the next coming message) and -2 to receive the earliest available offset. Note that because offsets are pulled in descending order, asking for the earliest offset will always return you a single element.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-OffsetResponse">Offset Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_313603" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">OffsetResponse =&gt; [TopicName [PartitionOffsets]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">PartitionOffsets =&gt; Partition ErrorCode [Offset]</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Offset =&gt; int64</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h5 id="AGuideToTheKafkaProtocol-OffsetCommit/FetchAPI">Offset Commit/Fetch API</h5>
    <p>These APIs allow for centralized management of offsets. Read more <a href="/confluence/display/KAFKA/Offset+Management">Offset Management</a>. As per comments on <a href="https://issues.apache.org/jira/browse/KAFKA-993" class="external-link" rel="nofollow">KAFKA-993</a> these API calls are not fully functional in releases until Kafka 0.8.1.1. It will be available in the 0.8.2 release.</p>
    <h6 id="AGuideToTheKafkaProtocol-GroupCoordinatorRequest">Group Coordinator Request</h6>
    <p>The offsets for a given consumer group are maintained by a specific broker called the group&nbsp;coordinator. i.e., a consumer needs to issue its offset commit and fetch requests to this specific broker. It can discover the current coordinator by issuing a group coordinator request.</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_65154" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">GroupCoordinatorRequest =&gt; GroupId</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-GroupCoordinatorResponse">Group Coordinator Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_93412" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">GroupCoordinatorResponse =&gt; ErrorCode CoordinatorId CoordinatorHost CoordinatorPort</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">CoordinatorId =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">CoordinatorHost =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">CoordinatorPort =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-OffsetCommitRequest">Offset Commit Request</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_543752" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">v0 (supported in </code><code class="java value">0.8</code><code class="java plain">.</code><code class="java value">1</code> <code class="java plain">or later)</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java plain">OffsetCommitRequest =&gt; ConsumerGroupId [TopicName [Partition Offset Metadata]]</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerGroupId =&gt; string</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Offset =&gt; int64</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java plain">&nbsp;Metadata =&gt; string</code>
                                        </div>
                                        <div class="line number8 index7 alt1">&nbsp;</div>
                                        <div class="line number9 index8 alt2"><code class="java plain">&nbsp;</code>
                                        </div>
                                        <div class="line number10 index9 alt1"><code class="java plain">v1 (supported in </code><code class="java value">0.8</code><code class="java plain">.</code><code class="java value">2</code> <code class="java plain">or later)</code>
                                        </div>
                                        <div class="line number11 index10 alt2"><code class="java plain">OffsetCommitRequest =&gt; ConsumerGroupId ConsumerGroupGenerationId ConsumerId [TopicName [Partition Offset TimeStamp Metadata]]</code>
                                        </div>
                                        <div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerGroupId =&gt; string</code>
                                        </div>
                                        <div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerGroupGenerationId =&gt; int32</code>
                                        </div>
                                        <div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerId =&gt; string</code>
                                        </div>
                                        <div class="line number15 index14 alt2"><code class="java spaces">&nbsp;</code><code class="java plain">&nbsp;TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Offset =&gt; int64</code>
                                        </div>
                                        <div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TimeStamp =&gt; int64</code>
                                        </div>
                                        <div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Metadata =&gt; string</code>
                                        </div>
                                        <div class="line number20 index19 alt1">&nbsp;</div>
                                        <div class="line number21 index20 alt2"><code class="java plain">v2 (supported in </code><code class="java value">0.8</code><code class="java plain">.</code><code class="java value">3</code> <code class="java plain">or later)</code>
                                        </div>
                                        <div class="line number22 index21 alt1"><code class="java plain">OffsetCommitRequest =&gt; ConsumerGroup ConsumerGroupGenerationId ConsumerId RetentionTime [TopicName [Partition Offset Metadata]]</code>
                                        </div>
                                        <div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerGroupId =&gt; string</code>
                                        </div>
                                        <div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerGroupGenerationId =&gt; int32</code>
                                        </div>
                                        <div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerId =&gt; string</code>
                                        </div>
                                        <div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">RetentionTime =&gt; int64</code>
                                        </div>
                                        <div class="line number27 index26 alt2"><code class="java spaces">&nbsp;</code><code class="java plain">&nbsp;TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Offset =&gt; int64</code>
                                        </div>
                                        <div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Metadata =&gt; string</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p>In v0 and v1, the time stamp of each partition is defined as the commit time stamp, and the offset coordinator will retain the committed offset until its commit time stamp + offset retention time specified in the broker config; if the time stamp field is not set, brokers will set the commit time as the receive time before committing the offset, users can explicitly set the commit time stamp if they want to retain the committed offset longer on the broker than the configured offset retention time.</p>
    <p>In v2, we removed the time stamp field but add a global retention time field (see <a href="https://issues.apache.org/jira/browse/KAFKA-1634" class="external-link" rel="nofollow">KAFKA-1634</a> for details); brokers will then always set the commit time stamp as the receive time, but the committed offset can be retained until its commit time stamp + user specified retention time in the commit request. If the retention time is not set, the broker offset retention time will be used as default.</p>
    <p>&nbsp;</p>
    <h6 id="AGuideToTheKafkaProtocol-OffsetCommitResponse">Offset Commit Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_61526" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">v0, v1 and v2:</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java plain">OffsetCommitResponse =&gt; [TopicName [Partition ErrorCode]]]</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-OffsetFetchRequest">Offset Fetch Request</h6>
    <p>Per the comment on </p>
    <div class="aui-message warning jim-inline-block"> <span class="aui-icon icon-warning"></span>JIRA Issues Macro: The JIRA server returned a trusted apps error: USER_UNKNOWN; Unknown User: {0}; ["h12"] </div> , v0 and v1 are identical on the wire, but v0 (supported in 0.8.1 or later) reads offsets from zookeeper, while v1 (supported in 0.8.2 or later) reads offsets from kafka.
    <p></p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_730801" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">OffsetFetchRequest =&gt; ConsumerGroup [TopicName [Partition]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ConsumerGroup =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-OffsetFetchResponse">Offset Fetch Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_307829" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">OffsetFetchResponse =&gt; [TopicName [Partition Offset Metadata ErrorCode]]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">TopicName =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Offset =&gt; int64</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Metadata =&gt; string</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p>Note that if there is no offset associated with a topic-partition under that consumer group the broker does not set an error code (since it is not really an error), but returns empty metadata and sets the offset field to -1.</p>
    <h5 id="AGuideToTheKafkaProtocol-GroupMembershipAPI">Group Membership API</h5>
    <p>These requests are used by clients to participate in a client group managed by Kafka. From a high level, each group in the cluster is assigned one the brokers (its group coordinator) to facilitate group management. Once the coordinator has been located (using the group coordinator request from above), group members can join the group and synchronize state, and then use heartbeats to stay active in the group. When the client shuts down, it uses a leave group request to deregister from the group. More detail on protocol semantics is outlined in&nbsp;<a href="/confluence/display/KAFKA/Kafka+Client-side+Assignment+Proposal">Kafka Client-side Assignment Proposal</a><span>.</span>
    </p>
    <p>The primary use case for the membership API is consumer groups, but the requests are intentionally generic to support other cases (e.g. Kafka Connect groups). The cost of this generality is that specific group semantics are pushed into the client. For example, the JoinGroup/SyncGroup requests defined below have no explicit fields supporting partition assignment for consumer groups. Instead, they contain generic byte arrays in which assignments can be embedded by the consumer client implementation.</p>
    <p>But although this allows each client implementation to define its own embedded schema, compatibility with Kafka tooling requires clients to use the standard embedded schema used by the client shipped with Kafka. The consumer-groups.sh utility, for example, assumes this format to display partition assignments. We therefore recommend that clients should follow the same schema so that these tools will work for all client implementations.</p>
    <h6 id="AGuideToTheKafkaProtocol-JoinGroupRequest">Join Group Request</h6>
    <p>The join group request is used by a client to become a member of a group. When new members join an existing group, all previous members are required to rejoin by sending a new join group request.&nbsp;When a member first joins the group, the memberId will be empty (i.e. ""), but a rejoining member should use the same memberId from the previous generation.&nbsp;</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_406664" class="syntaxhighlighter nogutter  java  ">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">JoinGroupRequest =&gt; GroupId SessionTimeout MemberId ProtocolType GroupProtocols</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">SessionTimeout =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ProtocolType =&gt; string</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupProtocols =&gt; [ProtocolName ProtocolMetadata]</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ProtocolName =&gt; string</code>
                                        </div>
                                        <div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ProtocolMetadata =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p>The <code>ProtocolType</code> field defines the embedded protocol that the group implements. The group coordinator ensures that all members in the group support the same protocol type. The meaning of the protocol name and metadata contained in the <code>GroupProtocols</code> field depends on the protocol type.&nbsp;Note that the join group request allows for multiple protocol/metadata pairs. This enables rolling upgrades without downtime. The coordinator chooses a single protocol which all members support. The upgraded member includes both the new version and the old version of the protocol. Once all members have upgraded, the coordinator will choose whichever protocol is listed first in the <code style="line-height: 1.42857;">GroupProtocols</code> array.</p>
    <p><strong>Consumer groups</strong>: Below we define the embedded protocol used by consumer groups.&nbsp;<span>We recommend all consumer implementations follow this format so that tooling will work correctly across all clients.</span>
    </p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_124687" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">ProtocolType =&gt; </code><code class="java string">"consumer"</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java plain">&nbsp;</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java plain">ProtocolName =&gt; AssignmentStrategy</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">AssignmentStrategy =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java plain">&nbsp;</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java plain">ProtocolMetadata =&gt; Version Subscription UserData</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java plain">&nbsp;Version =&gt; int16</code>
                                        </div>
                                        <div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Subscription =&gt; [Topic]</code>
                                        </div>
                                        <div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Topic =&gt; string</code>
                                        </div>
                                        <div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">UserData =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p>The <code>UserData</code> field can be used by custom partition assignment strategies. For example, in a sticky partitioning implementation, this field can contain the assignment from the previous generation. In a resource-based assignment strategy, it could include the number of cpus on the machine hosting each consumer instance.</p>
    <p>Kafka Connect uses the "connect" protocol type and its protocol details are internal to the Connect implementation.</p>
    <h6 id="AGuideToTheKafkaProtocol-JoinGroupResponse">Join Group Response</h6>
    <p>After receiving join group requests from all members in the group, the coordinator will select one member to be the group leader and a protocol which is supported by all members.&nbsp;The leader will receive the full list of members along with the associated metadata for the protocol chosen. Other members, followers, will receive an empty array of members.&nbsp;<span>It is the responsibility of the leader to inspect the metadata of each member and assign state using SyncGroup request below.</span>
    </p>
    <p><span>Upon every completion of the join group phase, the coordinator increments a&nbsp;</span><code>GenerationId</code><span>&nbsp;for the group. This is returned as a field in the response to each member, and is sent in heartbeats and offset commit requests. When the coordinator rebalances a group, the coordinator will send an error code indicating that the member needs to rejoin. If the member does not rejoin before a rebalance completes, then it will have an old generationId, which will cause ILLEGAL_GENERATION errors when included in new requests.</span>
    </p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_444121" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">JoinGroupResponse =&gt; ErrorCode GenerationId GroupProtocol LeaderId MemberId Members</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GenerationId =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupProtocol =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">LeaderId =&gt; string</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Members =&gt; [MemberId MemberMetadata]</code>
                                        </div>
                                        <div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                        <div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MemberMetadata =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p><strong>Consumer groups:</strong>&nbsp;The coordinator is responsible for choosing a protocol (i.e. partition assignment strategy) compatible across all members. The leader then is the member which actually performs the selected assignment. Multiple assignment strategies can be included in the join group request to support either an upgrade of an existing version or a change to a different assignment strategy.</p>
    <h6 id="AGuideToTheKafkaProtocol-SyncGroupRequest">SyncGroup Request</h6>
    <p>The sync group request is used by the group leader to assign state (e.g. partition assignments) to all members of the current generation. All members send SyncGroup immediately after joining the group, but only the leader provides the group's assignment.</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_221804" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">SyncGroupRequest =&gt; GroupId GenerationId MemberId GroupAssignment</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GenerationId =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupAssignment =&gt; [MemberId MemberAssignment]</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MemberAssignment =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p><strong>Consumer Groups:</strong> The format of the&nbsp;<code>MemberAssignment</code>&nbsp;field for consumer groups is included below:</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_124279" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">MemberAssignment =&gt; Version PartitionAssignment</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Version =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">PartitionAssignment =&gt; [Topic [Partition]]</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Topic =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Partition =&gt; int32</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">UserData =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <p>All client implementations using the "consumer" protocol type should support this schema.</p>
    <h6 id="AGuideToTheKafkaProtocol-SyncGroupResponse">Sync Group Response</h6>
    <p>Each member in the group will receive the assignment from the leader in the sync group response.&nbsp;</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_887015" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">SyncGroupResponse =&gt; ErrorCode MemberAssignment</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MemberAssignment =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-HeartbeatRequest">Heartbeat Request</h6>
    <p>Once a member has joined and synced, it will begin sending periodic heartbeats to keep itself in the group. If not heartbeat has been received by the coordinator with the configured session timeout, the member will be kicked out of the group.</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_320443" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">HeartbeatRequest =&gt; GroupId GenerationId MemberId</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GenerationId =&gt; int32</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-HeartbeatResponse">Heartbeat Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_984116" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">HeartbeatResponse =&gt; ErrorCode</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-LeaveGroupRequest">LeaveGroup Request</h6>
    <p>To explicitly leave a group, the client can send a leave group request. This is preferred over letting the session timeout expire since it allows the group to rebalance faster, which for the consumer means that less time will elapse before partitions can be reassigned to an active member.</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_890351" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">LeaveGroupRequest =&gt; GroupId MemberId</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-LeaveGroupResponse">LeaveGroup Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_463873" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">LeaveGroupResponse =&gt; ErrorCode</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h5 id="AGuideToTheKafkaProtocol-AdministrativeAPI">Administrative API</h5>
    <h6 id="AGuideToTheKafkaProtocol-ListGroupsRequest">ListGroups Request</h6>
    <p>This API can be used to find the current groups managed by a broker. To get a list of all groups in the cluster, you must send ListGroup to all brokers.</p>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_621442" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">ListGroupsRequest =&gt;</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-ListGroupsResponse">ListGroups Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_419913" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">ListGroupsResponse =&gt; ErrorCode Groups</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Groups =&gt; [GroupId ProtocolType]</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ProtocolType =&gt; string</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-DescribeGroupsRequest">DescribeGroups Request</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_774184" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">DescribeGroupsRequest =&gt; [GroupId]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h6 id="AGuideToTheKafkaProtocol-DescribeGroupsResponse">DescribeGroups Response</h6>
    <div class="code panel pdl" style="border-width: 1px;">
        <div class="codeContent panelContent pdl">
            <div>
                <div id="highlighter_199212" class="syntaxhighlighter nogutter  java">
                    <div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="code">
                                    <div class="container" title="Hint: double-click to select code">
                                        <div class="line number1 index0 alt2"><code class="java plain">DescribeGroupsResponse =&gt; [ErrorCode GroupId State ProtocolType Protocol Members]</code>
                                        </div>
                                        <div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ErrorCode =&gt; int16</code>
                                        </div>
                                        <div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">GroupId =&gt; string</code>
                                        </div>
                                        <div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">State =&gt; string</code>
                                        </div>
                                        <div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ProtocolType =&gt; string</code>
                                        </div>
                                        <div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Protocol =&gt; string</code>
                                        </div>
                                        <div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Members =&gt; [MemberId ClientId ClientHost MemberMetadata MemberAssignment]</code>
                                        </div>
                                        <div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MemberId =&gt; string</code>
                                        </div>
                                        <div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ClientId =&gt; string</code>
                                        </div>
                                        <div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ClientHost =&gt; string</code>
                                        </div>
                                        <div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MemberMetadata =&gt; bytes</code>
                                        </div>
                                        <div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MemberAssignment =&gt; bytes</code>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <h4 id="AGuideToTheKafkaProtocol-Constants">Constants</h4>
    <h5 id="AGuideToTheKafkaProtocol-ApiKeys">Api Keys</h5>
    <p>The following are the numeric codes that the ApiKey in the request can take for each of the above request types.</p>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 318px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>API name</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>ApiKey Value</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>API name</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>ApiKey Value</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>ProduceRequest</p>
                    </td>
                    <td class="confluenceTd">
                        <p>0</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>FetchRequest</p>
                    </td>
                    <td class="confluenceTd">
                        <p>1</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>OffsetRequest</p>
                    </td>
                    <td class="confluenceTd">
                        <p>2</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MetadataRequest</p>
                    </td>
                    <td class="confluenceTd">
                        <p>3</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Non-user facing control APIs</p>
                    </td>
                    <td class="confluenceTd">
                        <p>4-7</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>OffsetCommitRequest</p>
                    </td>
                    <td class="confluenceTd">
                        <p>8</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>OffsetFetchRequest</p>
                    </td>
                    <td class="confluenceTd">
                        <p>9</p>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">GroupCoordinatorRequest</td>
                    <td colspan="1" class="confluenceTd">10</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">JoinGroupRequest</td>
                    <td colspan="1" class="confluenceTd">
                        <p>11</p>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">HeartbeatRequest</td>
                    <td colspan="1" class="confluenceTd">12</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">LeaveGroupRequest</td>
                    <td colspan="1" class="confluenceTd">13</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">SyncGroupRequest</td>
                    <td colspan="1" class="confluenceTd">14</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">DescribeGroupsRequest</td>
                    <td colspan="1" class="confluenceTd">15</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">ListGroupsRequest</td>
                    <td colspan="1" class="confluenceTd">16</td>
                </tr>
            </tbody>
        </table>
    </div>
    <h5 id="AGuideToTheKafkaProtocol-ErrorCodes">Error Codes</h5>
    <p>We use numeric codes to indicate what problem occurred on the server. These can be translated by the client into exceptions or whatever the appropriate error handling mechanism in the client language. Here is a table of the error codes currently in use:</p>
    <div class="table-wrap">
        <table style="padding: 0px;" class="confluenceTable tablesorter tablesorter-default stickyTableHeaders">
            <thead style="position: static; margin-top: 0px; left: 288px; z-index: 3; width: 1213px; top: 0px;" class="tableFloatingHeaderOriginal">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Error</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Code</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none; min-width: 0px; max-width: none;" unselectable="on" tabindex="0" data-column="2" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <thead style="display: none;" class="tableFloatingHeader">
                <tr class="tablesorter-headerRow">
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="0" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Error</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="1" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Code</p>
                        </div>
                    </th>
                    <th style="-moz-user-select: none;" unselectable="on" tabindex="0" data-column="2" class="confluenceTh sortableHeader">
                        <div class="tablesorter-header-inner">
                            <p>Description</p>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="confluenceTd">
                        <p>NoError</p>
                    </td>
                    <td class="confluenceTd">
                        <p>0</p>
                    </td>
                    <td class="confluenceTd">
                        <p>No error--it worked!</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>Unknown</p>
                    </td>
                    <td class="confluenceTd">
                        <p>-1</p>
                    </td>
                    <td class="confluenceTd">
                        <p>An unexpected server error</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>OffsetOutOfRange</p>
                    </td>
                    <td class="confluenceTd">
                        <p>1</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The requested offset is outside the range of offsets maintained by the server for the given topic/partition.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>InvalidMessage</p>
                    </td>
                    <td class="confluenceTd">
                        <p>2</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This indicates that a message contents does not match its CRC</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>UnknownTopicOrPartition</p>
                    </td>
                    <td class="confluenceTd">
                        <p>3</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This request is for a topic or partition that does not exist on this broker.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>InvalidMessageSize</p>
                    </td>
                    <td class="confluenceTd">
                        <p>4</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The message has a negative size</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>LeaderNotAvailable</p>
                    </td>
                    <td class="confluenceTd">
                        <p>5</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This error is thrown if we are in the middle of a leadership election and there is currently no leader for this partition and hence it is unavailable for writes.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>NotLeaderForPartition</p>
                    </td>
                    <td class="confluenceTd">
                        <p>6</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This error is thrown if the client attempts to send messages to a replica that is not the leader for some partition. It indicates that the clients metadata is out of date.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>RequestTimedOut</p>
                    </td>
                    <td class="confluenceTd">
                        <p>7</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This error is thrown if the request exceeds the user-specified time limit in the request.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>BrokerNotAvailable</p>
                    </td>
                    <td class="confluenceTd">
                        <p>8</p>
                    </td>
                    <td class="confluenceTd">
                        <p>This is not a client facing error and is used mostly by tools when a broker is not alive.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p><span>ReplicaNotAvailable</span>
                        </p>
                    </td>
                    <td class="confluenceTd">
                        <p>9</p>
                    </td>
                    <td class="confluenceTd">
                        <p>If replica is expected on a broker, but is not (this can be safely ignored).</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>MessageSizeTooLarge</p>
                    </td>
                    <td class="confluenceTd">
                        <p>10</p>
                    </td>
                    <td class="confluenceTd">
                        <p>The server has a configurable maximum message size to avoid unbounded memory allocation. This error is thrown if the client attempt to produce a message larger than this maximum.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>StaleControllerEpochCode</p>
                    </td>
                    <td class="confluenceTd">
                        <p>11</p>
                    </td>
                    <td class="confluenceTd">
                        <p>Internal error code for broker-to-broker communication.</p>
                    </td>
                </tr>
                <tr>
                    <td class="confluenceTd">
                        <p>OffsetMetadataTooLargeCode</p>
                    </td>
                    <td class="confluenceTd">
                        <p>12</p>
                    </td>
                    <td class="confluenceTd">
                        <p>If you specify a string larger than configured maximum for offset metadata</p>
                    </td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">GroupLoadInProgressCode</td>
                    <td colspan="1" class="confluenceTd">14</td>
                    <td colspan="1" class="confluenceTd">The broker returns this error code for an offset fetch request if it is still loading offsets (after a leader change for that offsets topic partition), or in response to group membership requests (such as heartbeats) when group metadata is being loaded by the coordinator.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">GroupCoordinatorNotAvailableCode</td>
                    <td colspan="1" class="confluenceTd">15</td>
                    <td colspan="1" class="confluenceTd">The broker returns this error code for group coordinator requests, offset commits, and most group management requests if the offsets topic has not yet been created, or if the group coordinator is not active.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">NotCoordinatorForGroupCode</td>
                    <td colspan="1" class="confluenceTd">16</td>
                    <td colspan="1" class="confluenceTd">The broker returns this error code if it receives an offset fetch or commit request for a group that it is not a coordinator for.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">InvalidTopicCode</td>
                    <td colspan="1" class="confluenceTd">17</td>
                    <td colspan="1" class="confluenceTd">For a request which attempts to access an invalid topic (e.g. one which has an illegal name), or if an attempt is made to write to an internal topic (such as the consumer offsets topic).</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">RecordListTooLargeCode</td>
                    <td colspan="1" class="confluenceTd">18</td>
                    <td colspan="1" class="confluenceTd">If a message batch in a produce request exceeds the maximum configured segment size.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">NotEnoughReplicasCode</td>
                    <td colspan="1" class="confluenceTd">19</td>
                    <td colspan="1" class="confluenceTd">Returned from a produce request when the number of in-sync replicas is lower than the configured minimum and requiredAcks is -1.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">NotEnoughReplicasAfterAppendCode</td>
                    <td colspan="1" class="confluenceTd">20</td>
                    <td colspan="1" class="confluenceTd">Returned from a produce request when the message was written to the log, but with fewer in-sync replicas than required.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">InvalidRequiredAcksCode</td>
                    <td colspan="1" class="confluenceTd">21</td>
                    <td colspan="1" class="confluenceTd">Returned from a produce request if the requested requiredAcks is invalid (anything other than -1, 1, or 0).</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">IllegalGenerationCode</td>
                    <td colspan="1" class="confluenceTd">22</td>
                    <td colspan="1" class="confluenceTd">Returned from group membership requests (such as heartbeats) when the generation id provided in the request is not the current generation.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">InconsistentGroupProtocolCode</td>
                    <td colspan="1" class="confluenceTd">23</td>
                    <td colspan="1" class="confluenceTd">Returned in join group when the member provides a protocol type or set of protocols which is not compatible with the current group.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">InvalidGroupIdCode</td>
                    <td colspan="1" class="confluenceTd">24</td>
                    <td colspan="1" class="confluenceTd">Returned in join group when the groupId is empty or null.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">UnknownMemberIdCode</td>
                    <td colspan="1" class="confluenceTd">25</td>
                    <td colspan="1" class="confluenceTd">Returned from group requests (offset commits/fetches, heartbeats, etc) when the memberId is not in the current generation.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">InvalidSessionTimeoutCode</td>
                    <td colspan="1" class="confluenceTd">26</td>
                    <td colspan="1" class="confluenceTd">Return in join group when the requested session timeout is outside of the allowed range on the broker</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">RebalanceInProgressCode</td>
                    <td colspan="1" class="confluenceTd">27</td>
                    <td colspan="1" class="confluenceTd">Returned in heartbeat requests when the coordinator has begun rebalancing the group. This indicates to the client that it should rejoin the group.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">InvalidCommitOffsetSizeCode</td>
                    <td colspan="1" class="confluenceTd">28</td>
                    <td colspan="1" class="confluenceTd">This error indicates that an offset commit was rejected because of oversize metadata.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">TopicAuthorizationFailedCode</td>
                    <td colspan="1" class="confluenceTd">29</td>
                    <td colspan="1" class="confluenceTd">Returned by the broker when the client is not authorized to access the requested topic.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">GroupAuthorizationFailedCode</td>
                    <td colspan="1" class="confluenceTd">30</td>
                    <td colspan="1" class="confluenceTd">Returned by the broker when the client is not authorized to access a particular groupId.</td>
                </tr>
                <tr>
                    <td colspan="1" class="confluenceTd">ClusterAuthorizationFailedCode</td>
                    <td colspan="1" class="confluenceTd">31</td>
                    <td colspan="1" class="confluenceTd">Returned by the broker when the client is not authorized to use an inter-broker or administrative API.</td>
                </tr>
            </tbody>
        </table>
    </div>
    <h3 id="AGuideToTheKafkaProtocol-SomeCommonPhilosophicalQuestions">Some Common Philosophical Questions</h3>
    <p>Some people have asked why we don't use HTTP. There are a number of reasons, the best is that client implementors can make use of some of the more advanced TCP features--the ability to multiplex requests, the ability to simultaneously poll many connections, etc. We have also found HTTP libraries in many languages to be surprisingly shabby.</p>
    <p>Others have asked if maybe we shouldn't support many different protocols. Prior experience with this was that it makes it very hard to add and test new features if they have to be ported across many protocol implementations. Our feeling is that most users don't really see multiple protocols as a feature, they just want a good reliable client in the language of their choice.</p>
    <p>Another question is why we don't adopt XMPP, STOMP, AMQP or an existing protocol. The answer to this varies by protocol, but in general the problem is that the protocol does determine large parts of the implementation and we couldn't do what we are doing if we didn't have control over the protocol. Our belief is that it is possible to do better than existing messaging systems have in providing a truly distributed messaging system, and to do this we need to build something that works differently.</p>
    <p>A final question is why we don't use a system like Protocol Buffers or Thrift to define our request messages. These packages excel at helping you to managing lots and lots of serialized messages. However we have only a few messages. Support across languages is somewhat spotty (depending on the package). Finally the mapping between binary log format and wire protocol is something we manage somewhat carefully and this would not be possible with these systems. Finally we prefer the style of versioning APIs explicitly and checking this to inferring new values as nulls as it allows more nuanced control of&nbsp;compatibility.</p>
</body>
